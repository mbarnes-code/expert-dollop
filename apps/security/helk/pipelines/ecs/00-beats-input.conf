# Beats Input with ECS normalization
# Receives data from Filebeat, Winlogbeat, etc.
input {
  beats {
    port => 5044
    ssl => false
    # ECS compatibility mode
    ecs_compatibility => v8
  }
}

filter {
  # Add base ECS fields
  mutate {
    add_field => {
      "[ecs][version]" => "8.0"
      "[event][module]" => "beats"
      "[event][kind]" => "event"
    }
  }

  # Normalize timestamp to @timestamp (ECS standard)
  if [timestamp] {
    date {
      match => [ "timestamp", "ISO8601" ]
      target => "@timestamp"
    }
  }

  # Normalize agent fields to ECS
  if [beat] {
    mutate {
      copy => { "[beat][hostname]" => "[agent][hostname]" }
      copy => { "[beat][name]" => "[agent][name]" }
      copy => { "[beat][version]" => "[agent][version]" }
    }
  }

  # Normalize host fields to ECS
  if [host][name] {
    mutate {
      copy => { "[host][name]" => "[host][hostname]" }
    }
  }
}
